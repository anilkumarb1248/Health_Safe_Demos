CREATE TABLE PRTL(
	PRTL_ID INT(11) NOT NULL AUTO_INCREMENT,
	PRTL_SHRT_NM VARCHAR(40) DEFAULT NULL,
	PRTL_VER VARCHAR(20) DEFAULT NULL,
	PRTL_LNG_NM VARCHAR(255) DEFAULT NULL,
	PRTL_DSPL_NM VARCHAR(255) DEFAULT NULL,
	PRTL_LND_DFLT_PG_URL VARCHAR(255) DEFAULT NULL,
	MBR_PRTL_SPC_MBR_ID_NM VARCHAR(45) DEFAULT NULL,
	PARNT_PRTL_ID INT(11) DEFAULT NULL,
	CREAT_BY VARCHAR(40) NOT NULL,
	CREAT_TS DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	UPDT_BY VARCHAR(40) NOT NULL,
	UPDT_TS DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY (PRTL_ID),
	UNIQUE KEY AK_PRTL (PRTL_SHRT_NM, PRTL_VER)
);


CREATE TABLE MBR_STS(
	MBR_STS_ID INT(11) NOT NULL AUTO_INCREMENT,
	MBR_STS_NM VARCHAR(20) DEFAULT NULL,
	MBR_STS_DESC VARCHAR(100) DEFAULT NULL,
	CREAT_BY VARCHAR(40) NOT NULL,
	CREAT_TS DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	UPDT_BY VARCHAR(40) NOT NULL,
	UPDT_TS DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY (MBR_STS_ID),
	UNIQUE KEY AK_MBR_STS (MBR_STS_NM)
);

CREATE TABLE MBR(
	PRVSN_MBR_ID INT(11) NOT NULL AUTO_INCREMENT,
	HLTHSF_ID VARCHAR(36) DEFAULT NULL,
	MDM_FST_NM VARCHAR(40) NOT NULL,
	MDM_LST_NM VARCHAR(40) NOT NULL,
	PREF_NM VARCHAR(40) DEFAULT NULL,
	EMAIL_ADDR VARCHAR(255) DEFAULT NULL,
	MDM_MBR_DOB DATE DEFAULT NULL,
	MDM_MBR_SBSCR_ID VARCHAR(20) DEFAULT NULL,
	MDM_MBR_POL_NBR VARCHAR(30) DEFAULT NULL,
	MDM_MBR_CARR_ID VARCHAR(25) DEFAULT NULL,
	MDM_MBR_EMPLR_ID VARCHAR(25) DEFAULT NULL,
	MDM_MBR_ACCT_ID VARCHAR(25) DEFAULT NULL,
	MDM_MBR_PRTCP_ID VARCHAR(25) DEFAULT NULL,
	MDM_MBR_CLM_ID VARCHAR(25) DEFAULT NULL,
	MDM_MBR_SSN VARCHAR(512) DEFAULT NULL,
	MDM_MBR_ENCRP_SSN VARCHAR(512) DEFAULT NULL,
	MDM_MBR_EID VARCHAR(20) DEFAULT NULL,
	MDM_MBR_ZIP_CD VARCHAR(10) DEFAULT NULL,
	MDM_OVRD_IND VARCHAR(1) NOT NULL DEFAULT '0',
	TERM_AND_COND_ACPT_DT DATE DEFAULT NULL,
	MBR_STS_ID INT DEFAULT NULL,
	MBR_RGST_TYP_ID INT NOT NULL DEFAULT '1',
	CREAT_BY VARCHAR(40) NOT NULL,
	CREAT_TS DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	UPDT_BY VARCHAR(40) NOT NULL,
	UPDT_TS DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	MBR_RGST_PRTL_ID INT DEFAULT NULL,
	PRIMARY KEY (PRVSN_MBR_ID),
	UNIQUE KEY AK_MBR (HLTHSF_ID),
	CONSTRAINT FK_MBR_STS_MBR FOREIGN KEY (MBR_STS_ID) REFERENCES MBR_STS (MBR_STS_ID) ON DELETE RESTRICT ON UPDATE RESTRICT,
	CONSTRAINT FK_MBR_RGST_PRTL_ID FOREIGN KEY (MBR_RGST_PRTL_ID) REFERENCES PRTL (PRTL_ID) ON DELETE RESTRICT ON UPDATE RESTRICT
);

CREATE TABLE MBR_PRTL (
	MBR_PRTL_ID INT(11) NOT NULL AUTO_INCREMENT,
	PRTL_ID INT(11) NOT NULL,
	MBR_PRTL_FST_NM VARCHAR(40) DEFAULT NULL,
	MBR_PRTL_LST_NM VARCHAR(40) DEFAULT NULL,
	MBR_PRTL_DOB DATE DEFAULT NULL,
	MBR_PRTL_GDR VARCHAR(1) DEFAULT NULL,
	MBR_PRTL_SBSCR_ID VARCHAR(36) DEFAULT NULL,
	MBR_PRTL_POL_NBR VARCHAR(30) DEFAULT NULL,
	MBR_PRTL_ADDR_LN_1_TXT VARCHAR(100) DEFAULT NULL,
	MBR_PRTL_ADDR_LN_2_TXT VARCHAR(100) DEFAULT NULL,
	MBR_PRTL_CTY_NM VARCHAR(50) DEFAULT NULL,
	MBR_PRTL_ST_NM VARCHAR(25) DEFAULT NULL,
	MBR_PRTL_ZIP_CD VARCHAR(10) DEFAULT NULL,
	MBR_PRTL_SSN VARCHAR(512) DEFAULT NULL,
	MBR_PRTL_ENCRP_SSN VARCHAR(512) DEFAULT NULL,
	MBR_PRTL_SPC_MBR_ID VARCHAR(25) DEFAULT NULL,
	PRVSN_MBR_ID INT DEFAULT NULL,
	MBR_STS_ID INT DEFAULT NULL,
	MBR_PRTL_ELIG_FAIL_DT DATETIME DEFAULT NULL,
	MBR_PRTL_EFF_DT DATE DEFAULT NULL,
	MBR_PRTL_EXPIR_DT DATE DEFAULT NULL,
	CREAT_BY VARCHAR(40) NOT NULL,
	CREAT_TS DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	UPDT_BY VARCHAR(40) NOT NULL,
	UPDT_TS DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	MBR_PRTL_ELIGIBILITY_RESPONSE JSON DEFAULT NULL,
	EXPIRE_TS DATETIME DEFAULT NULL,
	PRIMARY KEY (MBR_PRTL_ID),
	CONSTRAINT FK_MBR_PRTL_PRVSN_MBR_ID FOREIGN KEY (PRVSN_MBR_ID) REFERENCES MBR (PRVSN_MBR_ID) ON DELETE RESTRICT ON UPDATE RESTRICT,
	CONSTRAINT FK_MBR_PRTL_PRTL_ID FOREIGN KEY (PRTL_ID) REFERENCES PRTL (PRTL_ID) ON DELETE RESTRICT ON UPDATE RESTRICT,
	CONSTRAINT FK_MBR_PRTL_PRTL_STS_ID FOREIGN KEY (MBR_STS_ID) REFERENCES MBR_STS (MBR_STS_ID) ON DELETE RESTRICT ON UPDATE RESTRICT
);

CREATE TABLE ENBL_DSBL_RSN(
	ENBL_DSBL_RSN_ID INT(11) NOT NULL AUTO_INCREMENT,
	REASON VARCHAR(750) NOT NULL,
	RSN_TYP_CD ENUM('S', 'P') NOT NULL,
	CREAT_BY VARCHAR(40) NOT NULL,
	CREAT_TS DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	UPDT_BY VARCHAR(40) NOT NULL,
	UPDT_TS DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY (ENBL_DSBL_RSN_ID),
	UNIQUE KEY AK_ENBL_DSBL_RSN (REASON, RSN_TYP_CD)
);

CREATE TABLE ENBL_DSBL_MSG(
	ENBL_DSBL_MSG_ID INT(11) NOT NULL AUTO_INCREMENT,
	MESSAGE VARCHAR(750) NOT NULL,
	CREAT_BY VARCHAR(40) NOT NULL,
	CREAT_TS DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	UPDT_BY VARCHAR(40) NOT NULL,
	UPDT_TS DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY (ENBL_DSBL_MSG_ID),
	UNIQUE KEY AK_MESSAGE (MESSAGE)
);

CREATE TABLE PRTL_MSG_RSN_MAPPING(
	PRTL_MSG_RSN_MAP_ID INT(11) NOT NULL AUTO_INCREMENT,
	PRTL_ID INT(11) NOT NULL,
	ENBL_DSBL_MSG_ID INT(11) NOT NULL,
	RSN_TYP_CD ENUM('S', 'P') NOT NULL,
	CREAT_BY VARCHAR(40) NOT NULL,
	CREAT_TS DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	UPDT_BY VARCHAR(40) NOT NULL,
	UPDT_TS DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY (PRTL_MSG_RSN_MAP_ID),
	CONSTRAINT FK_PRTL_ID FOREIGN KEY (PRTL_ID) REFERENCES PRTL(PRTL_ID),
	CONSTRAINT FK_ENBL_DSBL_MSG_ID FOREIGN KEY (ENBL_DSBL_MSG_ID) REFERENCES ENBL_DSBL_MSG (ENBL_DSBL_MSG_ID),
	-- CONSTRAINT FK_RSN_TYP_CD FOREIGN KEY (RSN_TYP_CD) REFERENCES ENBL_DSBL_RSN (RSN_TYP_CD)
);

CREATE TABLE INCIDENT(
	INCIDENT_ID INT(11) NOT NULL AUTO_INCREMENT,
	HLTHSF_ID VARCHAR(36) NOT NULL,
	INCIDENT_NBR VARCHAR(20),
	PRTL_ID INT(11) NOT NULL,
	ENBL_DSBL_MSG_ID INT(11) NOT NULL,
	ENBL_DSBL_RSN_ID INT(11) NOT NULL,
	ISSUE_OCC_TS DATETIME NOT NULL,
	ISSUE_OCC_TZ VARCHAR(12) NOT NULL,
	ISSUE_DESC VARCHAR(3000) NOT NULL,
	CALLER_FN VARCHAR(40) NOT NULL,
	CALLER_LN VARCHAR(40) NOT NULL,
	CALLER_PHNE VARCHAR(16),
	CALLER_EMAIL VARCHAR(128) NOT NULL,
	CALLER_AUTH_FOR_OTHR VARCHAR(40),
	CALLER_AUTH_MBR_ACC VARCHAR(40),
	CALLER_DEVICE VARCHAR(40),
	CALLER_INFO_SHARED VARCHAR(40),
	EMP_FN VARCHAR(40),
	EMP_LN VARCHAR(40),
	EMP_MSID VARCHAR(40),
	EMP_EMAIL VARCHAR(128),
	EMP_DESC VARCHAR(3000),
	RPRT_EMAIL VARCHAR(128) NOT NULL,
	RPRT_TS DATETIME NOT NULL,
	RPRT_TZ VARCHAR(12) NOT NULL,
	CREAT_BY VARCHAR(40) NOT NULL,
	CREAT_TS DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (INCIDENT_ID),
	UNIQUE KEY AK_INCIDENT (CREAT_TS, PRTL_ID, HLTHSF_ID),
	CONSTRAINT FK_HLTHSF_ID FOREIGN KEY (HLTHSF_ID) REFERENCES MBR(HLTHSF_ID),
	CONSTRAINT FK_INC_PRTL_ID FOREIGN KEY (PRTL_ID) REFERENCES PRTL(PRTL_ID),
	CONSTRAINT FK_INC_ENBL_DSBL_MSG_ID FOREIGN KEY (ENBL_DSBL_MSG_ID) REFERENCES ENBL_DSBL_MSG(ENBL_DSBL_MSG_ID),
	CONSTRAINT FK_INC_ENBL_DSBL_RSN_ID FOREIGN KEY (ENBL_DSBL_RSN_ID) REFERENCES ENBL_DSBL_RSN(ENBL_DSBL_RSN_ID)
);

CREATE TABLE INCIDENT_ACTION(
	INCIDENT_ACTION_ID INT(11) NOT NULL AUTO_INCREMENT,
	INCIDENT_ID INT(11) NOT NULL,
	CREAT_BY VARCHAR(40) NOT NULL,
	CREAT_TS DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (INCIDENT_ACTION_ID),
	CONSTRAINT FK_INCIDENT_ID FOREIGN KEY (INCIDENT_ID) REFERENCES INCIDENT(INCIDENT_ID)
);

CREATE TABLE INCIDENT_ACTION_MBR(
	INCIDENT_ACTION_MBR_ID INT(11) NOT NULL AUTO_INCREMENT,
	INCIDENT_ACTION_ID INT(11) NOT NULL,
	HLTHSF_ID VARCHAR(36) NOT NULL,
	MBR_TYPE ENUM('PRIMARY', 'IMPACTED'),
	ACTION_REQ ENUM('ENABLE', 'DISABLE'),
	CREAT_BY VARCHAR(40) NOT NULL,
	CREAT_TS DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (INCIDENT_ACTION_MBR_ID),
	CONSTRAINT FK_INCIDENT_ACTION_ID FOREIGN KEY (INCIDENT_ACTION_ID) REFERENCES INCIDENT_ACTION(INCIDENT_ACTION_ID),
	CONSTRAINT FK_INC_ACT_MBR_HLTHSF_ID FOREIGN KEY (HLTHSF_ID) REFERENCES MBR(HLTHSF_ID)
);